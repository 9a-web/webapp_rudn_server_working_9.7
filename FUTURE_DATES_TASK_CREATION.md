# Создание задач на будущие даты

## Описание изменений

Реализована возможность создания задач на будущие даты через кликабельные кнопки дней недели в разделе "Список дел".

## Внесенные изменения

### 1. WeekDateSelector.jsx - Кликабельные будущие даты

**Изменения в обработчике клика (строки 111-116):**
- **Было:** Клики на будущие даты блокировались проверкой `if (isFutureDay(date)) return;`
- **Стало:** Разрешены клики на все дни (прошедшие, сегодня, будущие)

```jsx
// БЫЛО:
const handleDayClick = (date) => {
  if (isFutureDay(date)) return; // Будущие дни неактивны
  if (hapticFeedback) hapticFeedback('impact', 'light');
  if (onDateSelect) onDateSelect(date);
};

// СТАЛО:
const handleDayClick = (date) => {
  // Разрешаем клики на все дни (включая будущие)
  if (hapticFeedback) hapticFeedback('impact', 'light');
  if (onDateSelect) onDateSelect(date);
};
```

**Изменения в кнопках дней (строки 139-157):**
- **Было:** Кнопки будущих дат имели `disabled={future}`, `opacity-40`, `cursor-not-allowed`
- **Стало:** Все кнопки активны, будущие даты имеют легкую прозрачность и синий hover-эффект

```jsx
// БЫЛО:
disabled={future}
whileTap={!future ? { scale: 0.95 } : {}}
className={`... ${future ? 'opacity-40 cursor-not-allowed' : 'cursor-pointer'} ...`}

// СТАЛО:
whileTap={{ scale: 0.95 }}
className={`... cursor-pointer
  ${selected ? '...' : future 
    ? 'bg-white border border-gray-200 hover:border-blue-300 hover:shadow-md opacity-70'
    : 'bg-white border border-gray-200 hover:border-yellow-300 hover:shadow-md'
  }
`}
```

**Визуальные изменения для будущих дат:**
- Название дня (строка 162): `text-gray-400` → `text-blue-500`
- Число месяца (строка 216): `text-gray-400` → `text-blue-600`
- Border hover эффект: `hover:border-yellow-300` → `hover:border-blue-300`

## Как это работает

### Workflow создания задач на будущие даты:

1. **Выбор даты:**
   - Пользователь кликает на кнопку с будущей датой в WeekDateSelector
   - Дата становится активной (желто-оранжевый градиент)
   - Haptic feedback подтверждает выбор

2. **Отображение задач:**
   - Карточка задач обновляется с заголовком для выбранной даты
   - Если задач нет → отображается "Нет задач"
   - Если есть задачи с target_date на эту дату → они отображаются

3. **Создание новой задачи:**
   - Пользователь нажимает кнопку "+ Добавить задачу"
   - Открывается AddTaskModal
   - **Важно:** AddTaskModal автоматически устанавливает `target_date` на выбранную дату
   - Задача создается и привязывается к выбранному дню

4. **Отображение созданной задачи:**
   - Новая задача появляется в карточке для выбранной даты
   - При переключении на другие даты задача остается привязанной к исходной дате

### Логика привязки задач к датам (getTasksForSelectedDate)

Задачи фильтруются по приоритетам:

**ПРИОРИТЕТ 1:** Задачи с `target_date`
- Показываются строго на дату, указанную в target_date
- Работает для прошедших, текущей и будущих дат

**ПРИОРИТЕТ 2:** Задачи с `deadline` (без target_date)
- Показываются на дату deadline
- Работает для всех дат

**ПРИОРИТЕТ 3:** Задачи без target_date и без deadline
- Показываются **ТОЛЬКО на сегодня**
- На будущих датах не отображаются

## Визуальные индикаторы

### Прошедшие дни:
- Текст: серый цвет
- Число: темно-серый
- Круговой progress bar: показывает % выполненных задач
- Hover: желтый border

### Сегодня:
- Текст: серый
- Число: оранжевый (#FF8C00)
- Круговой progress bar: показывает % выполненных задач
- Индикатор: оранжевая точка снизу
- Hover: желтый border

### Будущие дни (НОВОЕ):
- Текст: синий (#3B82F6)
- Число: темно-синий (#2563EB)
- Progress bar: отсутствует
- Прозрачность: 70%
- Hover: синий border
- Анимация: scale 0.95 при клике

### Выбранный день:
- Фон: желто-оранжевый градиент
- Текст и число: белый цвет
- Тень: желтая
- Progress bar: белый (для прошедших/сегодня)

## Технические детали

### AddTaskModal.jsx
Модальное окно уже настроено для работы с будущими датами:
- Получает проп `selectedDate` из TasksSection
- Автоматически форматирует target_date в формате `YYYY-MM-DDT00:00:00`
- Без конвертации в UTC (предотвращает смещение даты)

```jsx
let targetDateISO = null;
if (selectedDate) {
  const targetDate = new Date(selectedDate);
  const year = targetDate.getFullYear();
  const month = String(targetDate.getMonth() + 1).padStart(2, '0');
  const day = String(targetDate.getDate()).padStart(2, '0');
  targetDateISO = `${year}-${month}-${day}T00:00:00`;
}
```

### TasksSection.jsx
Компонент корректно обрабатывает будущие даты:
- `handleDateSelect()` обновляет `tasksSelectedDate` для любой даты
- `getCardTitle()` показывает правильный заголовок (день недели для будущих дат)
- `getTasksForSelectedDate()` фильтрует задачи по target_date

## Примеры использования

### Сценарий 1: Создание задачи на завтра
1. Кликнуть на кнопку "Вт 12" (завтра)
2. Карточка обновится → "Завтра" + дата
3. Нажать "+ Добавить задачу"
4. Ввести текст задачи
5. Сохранить
6. Задача появится в карточке "Завтра"

### Сценарий 2: Создание задачи на конец недели
1. Кликнуть на кнопку "Пт 15" (пятница)
2. Карточка обновится → "Пятница" + дата
3. Список задач пустой → "Нет задач"
4. Добавить задачи через кнопку "+"
5. Все задачи будут привязаны к пятнице

### Сценарий 3: Просмотр задач на разные дни
1. Переключаться между днями недели
2. Каждый день показывает только свои задачи
3. Задачи с target_date отображаются на соответствующие даты
4. Задачи без дат отображаются только на "Сегодня"

## Преимущества

✅ **Планирование наперед:** Можно создавать задачи на будущие дни  
✅ **Визуальная ясность:** Синий цвет четко указывает на будущие даты  
✅ **Простота использования:** Один клик на дату → кнопка "+" → создание задачи  
✅ **Согласованность:** Логика работает одинаково для всех дат  
✅ **Feedback:** Haptic feedback при каждом взаимодействии  

## Тестирование

### Проверка кликабельности:
- [x] Клик на прошедшую дату → работает
- [x] Клик на сегодня → работает
- [x] Клик на будущую дату → работает (НОВОЕ)
- [x] Haptic feedback срабатывает на всех датах

### Проверка создания задач:
- [ ] Создать задачу на завтра → должна привязаться к завтрашней дате
- [ ] Создать задачу на конец недели → должна привязаться к выбранному дню
- [ ] Переключиться на другую дату → задача остается на исходной дате
- [ ] Вернуться к дате задачи → задача отображается

### Проверка визуала:
- [x] Будущие даты имеют синий цвет (текст и число)
- [x] Будущие даты имеют прозрачность 70%
- [x] Hover на будущую дату → синий border
- [x] Выбранная будущая дата → желто-оранжевый градиент

## Файлы изменений

- `/app/frontend/src/components/WeekDateSelector.jsx` - основные изменения
- `/app/frontend/src/components/TasksSection.jsx` - без изменений (уже поддерживает будущие даты)
- `/app/frontend/src/components/AddTaskModal.jsx` - без изменений (уже поддерживает target_date)

## Дата реализации

2025-01-XX

## Статус

✅ **Реализовано и готово к тестированию**
